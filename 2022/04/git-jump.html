<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="git 高手跃迁" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="本文试图从应用和原理及设计层层多角度探究 git，帮助读者相对全面透彻的理解 git，并能 随心所欲高效地使用 git" /><meta property="og:description" content="本文试图从应用和原理及设计层层多角度探究 git，帮助读者相对全面透彻的理解 git，并能 随心所欲高效地使用 git" /><link rel="canonical" href="//code-winder.github.io/2022/04/git-jump.html" /><meta property="og:url" content="//code-winder.github.io/2022/04/git-jump.html" /><meta property="og:site_name" content="Code-Winder" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-03T19:11:48+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="git 高手跃迁" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-03T19:11:48+08:00","datePublished":"2022-04-03T19:11:48+08:00","description":"本文试图从应用和原理及设计层层多角度探究 git，帮助读者相对全面透彻的理解 git，并能 随心所欲高效地使用 git","headline":"git 高手跃迁","mainEntityOfPage":{"@type":"WebPage","@id":"//code-winder.github.io/2022/04/git-jump.html"},"url":"//code-winder.github.io/2022/04/git-jump.html"}</script><title>git 高手跃迁 | Code-Winder</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Code-Winder"><meta name="application-name" content="Code-Winder"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script> <script> // 百度统计代码 var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e37ebacf05386ebe11672ab0dc609b69"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <script> // google analytics (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '{site.google_analytics_id}}', 'auto'); ga('send', 'pageview'); </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/favicon.ico" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Code-Winder</a></div><div class="site-subtitle font-italic">灵感源于好奇</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/code-winder" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['414834682','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <i class="fas fa-list-alt fa-fw" id="content-list"></i> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>git 高手跃迁</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >X</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 class="title_class" data-toc-skip>git 高手跃迁</h1><div id="label_center"><div class="label"><div class="label-card"></div><div class="label-card"> <span class="categories"> <i class="fa fa-th-list"></i> <a href="/categories/%E9%AB%98%E6%95%88%E5%B7%A5%E5%85%B7" title="Category: 高效工具" rel="category">高效工具</a> </span></div><div class="label-card"> <span class="pageTag"> <i class="fa fa-tags"></i> <a href="/tags/tool" title="Tag: Tool" rel="tag">Tool</a> </span></div></div></div><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1648984308" data-df="YYYY/MM/DD" data-toggle="tooltip" data-placement="bottom"> 2022/04/03 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href="https://github.com/code-winder">code-winder</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8738 字"> <em>48 分钟</em>阅读</span></div></div></div><div class="post-content"><blockquote><p>本文试图从应用和原理及设计层层多角度探究 git，帮助读者相对全面透彻的理解 git，并能 随心所欲高效地使用 git</p></blockquote><ul id="markdown-toc"><li><a href="#俯视-git" id="markdown-toc-俯视-git">俯视 git</a><ul><li><a href="#基本流程" id="markdown-toc-基本流程">基本流程</a><li><a href="#基本概念" id="markdown-toc-基本概念">基本概念</a><ul><li><a href="#应用层面的概念" id="markdown-toc-应用层面的概念">应用层面的概念</a><li><a href="#底层概念" id="markdown-toc-底层概念">底层概念</a><li><a href="#git-存储快照是不是很低效" id="markdown-toc-git-存储快照是不是很低效">git 存储快照是不是很低效</a></ul><li><a href="#图解-git-的概念关系设计" id="markdown-toc-图解-git-的概念关系设计">图解 git 的概念关系设计</a></ul><li><a href="#git-命令及其使用场景" id="markdown-toc-git-命令及其使用场景">git 命令及其使用场景</a><ul><li><a href="#各区穿梭" id="markdown-toc-各区穿梭">各区穿梭</a><li><a href="#改变文件状态" id="markdown-toc-改变文件状态">改变文件状态</a><li><a href="#分支管理" id="markdown-toc-分支管理">分支管理</a><ul><li><a href="#分支互操作" id="markdown-toc-分支互操作">分支互操作</a><li><a href="#打补丁" id="markdown-toc-打补丁">打补丁</a><li><a href="#commit-整理" id="markdown-toc-commit-整理">commit 整理</a><li><a href="#查看分支列表" id="markdown-toc-查看分支列表">查看分支列表</a></ul><li><a href="#差异比较" id="markdown-toc-差异比较">差异比较</a><ul><li><a href="#commit-前比较" id="markdown-toc-commit-前比较">commit 前比较</a><li><a href="#commit-后比较" id="markdown-toc-commit-后比较">commit 后比较</a><li><a href="#不同分支间比较" id="markdown-toc-不同分支间比较">不同分支间比较</a><li><a href="#不同仓库间比较" id="markdown-toc-不同仓库间比较">不同仓库间比较</a><li><a href="#工具" id="markdown-toc-工具">工具</a></ul><li><a href="#查看或搜索提交历史" id="markdown-toc-查看或搜索提交历史">查看或搜索提交历史</a><li><a href="#后悔药" id="markdown-toc-后悔药">后悔药</a><li><a href="#git-操作原则" id="markdown-toc-git-操作原则">git 操作原则</a></ul></ul><h1 id="俯视-git">俯视 git</h1><p>本节将从应用中涉及到的顶层概念到底层实现原理，深入浅出地呈现 git 的蓝图。</p><h2 id="基本流程"><span class="mr-2">基本流程</span><a href="#基本流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/img/tool/git/git-017.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-017.png" alt="git 工作流" title="git 工作流" class="lazyload" data-proofer-ignore></a> <a href="https://www.plantuml.com/plantuml/svg/ZLPVRnf747_dKwpy4E67a_lSXyfLqwgLelO362fTOO5Jxi_fxd0JLP5mKXDeREC4WXn3QxkDKyjAZTMq60CMtwMwtQDF_WgPPRY3jS7s2nmtlvdzpVncPrXsFTNnyeOUi-5RIscsQdg4lpdvlx3Bwy_zNfkzFIUgIpAMdfOmMSrZPuV-HPDjT0NWHyjvwDfgYage1RxxbFsr0vYueYnfPfe-MagfgHnTWeEpT751k8f7sOtj5_b-QMnpSrT2Dj-pvcbGBec7RZN-zPUVtyT0kfLIvKo6WsPmz8ALMu0L28SQbaSVpC7vlIe4dE1YiQnZvMt2zhhWp_zT0qnCL88edqqI_bJKWcYcviMYTm30jD2efjCae-dqE-ShuSrBzM5XFR8e-PZ02YTC0PrIbc70bsAGXU2aC1oSBiH6LW53VeYpyswEM8wMrKpoWwEQgTotga4ZBlF2gb9aQgR3RB7ulBe9uaR4K0YCC7gSRo6kkae9szuC_ZoLM5n3HjRRu-0RkUmJf6tP9646ZGwxgFhThIcBQjiwVOm_bd_wv0cvTs_AcdOiUsAxyH0CzVWkc31YqA-pojaJO4RmqUziYPmmfM3tPzOwPzqQM_yGVEYnIill7SAr6mwUJmNKDTSZVEymQBwOriZlRFgTtrd_cT_x8zXVGp5ci7AewraE9VyLgYF8Z3PCc2EW8J3YQW9cPG9AXisAC8X7FRAYACdRGU9UoZ2mn-EiKkVj4iw5o_u6sownypOhdKRJHBoij8RFBlp-Bc-MMV7lu7XjCUnzwLxXIOhYMXcFYFE-bvAIpDZttzmN9Fp1hy7hDoC7m2TClhVjTuv3X21pKMNbJP28bml00QiCn18cgnppdHOcuNUBw8EN9UGeoo2LpT0UqNGIgSwfB49ke7jdiZEfibSRC7D2mb9BtQ6Ve3rI3wtyYEWrRJ72SB33cyUeBt2APFK79xnsZYMQ7nbb1CsaHWqB9G6ZMGUmBy9goOvGEzRu3Kh4cp3cNcBn-Fi3Njdsks_n4pW6lxHv0UN572BIqVeIg4O7RYkcSPlKYf9JdVHydT4UYPmmB_ibrkyE3pQ6xuf1euwiGyL3MCGJhh_S4_ExWJV-0RwN_R8quaj5NclvtLVZAO_hPB9O7apMHOPwgHnHR51yDIbaLtKz6Pk2NLal1dMoTBoEbYOI2IcYMyqgBuFQNdYnvyUIQZKp9DOig1rDBteiOHZuIamxh-jaJ0NACwABJEOuO056UUFo27abJ9cPeReUTH23vynWYDpmBypY3VjyvTf2Jzw0LZBa6bwSpBUE9bd9Vk7RrJXkb-b_GFxWWA-rnkFkdPZ1wss_1nliANyDh4UTj0mVUKF_2000" class="popup img-link "><img data-src="https://www.plantuml.com/plantuml/svg/ZLPVRnf747_dKwpy4E67a_lSXyfLqwgLelO362fTOO5Jxi_fxd0JLP5mKXDeREC4WXn3QxkDKyjAZTMq60CMtwMwtQDF_WgPPRY3jS7s2nmtlvdzpVncPrXsFTNnyeOUi-5RIscsQdg4lpdvlx3Bwy_zNfkzFIUgIpAMdfOmMSrZPuV-HPDjT0NWHyjvwDfgYage1RxxbFsr0vYueYnfPfe-MagfgHnTWeEpT751k8f7sOtj5_b-QMnpSrT2Dj-pvcbGBec7RZN-zPUVtyT0kfLIvKo6WsPmz8ALMu0L28SQbaSVpC7vlIe4dE1YiQnZvMt2zhhWp_zT0qnCL88edqqI_bJKWcYcviMYTm30jD2efjCae-dqE-ShuSrBzM5XFR8e-PZ02YTC0PrIbc70bsAGXU2aC1oSBiH6LW53VeYpyswEM8wMrKpoWwEQgTotga4ZBlF2gb9aQgR3RB7ulBe9uaR4K0YCC7gSRo6kkae9szuC_ZoLM5n3HjRRu-0RkUmJf6tP9646ZGwxgFhThIcBQjiwVOm_bd_wv0cvTs_AcdOiUsAxyH0CzVWkc31YqA-pojaJO4RmqUziYPmmfM3tPzOwPzqQM_yGVEYnIill7SAr6mwUJmNKDTSZVEymQBwOriZlRFgTtrd_cT_x8zXVGp5ci7AewraE9VyLgYF8Z3PCc2EW8J3YQW9cPG9AXisAC8X7FRAYACdRGU9UoZ2mn-EiKkVj4iw5o_u6sownypOhdKRJHBoij8RFBlp-Bc-MMV7lu7XjCUnzwLxXIOhYMXcFYFE-bvAIpDZttzmN9Fp1hy7hDoC7m2TClhVjTuv3X21pKMNbJP28bml00QiCn18cgnppdHOcuNUBw8EN9UGeoo2LpT0UqNGIgSwfB49ke7jdiZEfibSRC7D2mb9BtQ6Ve3rI3wtyYEWrRJ72SB33cyUeBt2APFK79xnsZYMQ7nbb1CsaHWqB9G6ZMGUmBy9goOvGEzRu3Kh4cp3cNcBn-Fi3Njdsks_n4pW6lxHv0UN572BIqVeIg4O7RYkcSPlKYf9JdVHydT4UYPmmB_ibrkyE3pQ6xuf1euwiGyL3MCGJhh_S4_ExWJV-0RwN_R8quaj5NclvtLVZAO_hPB9O7apMHOPwgHnHR51yDIbaLtKz6Pk2NLal1dMoTBoEbYOI2IcYMyqgBuFQNdYnvyUIQZKp9DOig1rDBteiOHZuIamxh-jaJ0NACwABJEOuO056UUFo27abJ9cPeReUTH23vynWYDpmBypY3VjyvTf2Jzw0LZBa6bwSpBUE9bd9Vk7RrJXkb-b_GFxWWA-rnkFkdPZ1wss_1nliANyDh4UTj0mVUKF_2000" alt="git 命令概览" class="lazyload" data-proofer-ignore></a></p><h2 id="基本概念"><span class="mr-2">基本概念</span><a href="#基本概念" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>概念是设计的很重要的元素和精简描述，因此我们将从基本概念入手窥探 git 的顶层设计思想。 同时，了解了基本概念之后，能够更好地利用搜索引擎查找所需的命令。同时也有助于我们理解上面的基本流程图。</p><h3 id="应用层面的概念"><span class="mr-2">应用层面的概念</span><a href="#应用层面的概念" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在用户使用git时都会涉及到以下这些应用层面的概念。这些概念往往会体现在常用的 git 命令的应用中。</p><ul><li><strong>工作区(workspace)</strong>：正常情况下能看到的目录(不包括隐藏文件，如同级目录下的 .git 隐藏目录), 也就是用户主动创建的目录，如通过系统命令 ls 或者文件管理器能够看到的目录。<li><strong>暂存区(stage/index)</strong>：<ul><li>工作区下的隐藏 .git 目录下的 index 文件（每个git仓库只有一个）, 因此也称为索引。<li>数据暂时存放的区域，类似于工作区写入版本库前的缓存区。<li>暂存区是独立于各个分支的。<li>实际上就是一个包含文件索引的目录树，像是一个虚拟的工作区。 在这个虚拟工作区的目录树中，记录了文件名、文件的状态信息（时间戳、文件长度等）， 文件的内容并不存储其中，而是保存在 git 对象库（.git/objects）中， 文件索引建立了文件和对象库中对象实体之间的对应关系。git 通过文件状态信息可以很高效地知道 哪些文件改变了。</ul><li><strong>版本库(Repository)</strong>：也称为本地仓库。<ul><li>在工作区中有一个隐藏文件 .git ，它不属于工作区，而是 git 版本库。<li>.git 目录下包括很多其他文件，其中重要的是暂存区（.git/index）、对象库（.git/objects）、 分支（master 分支和其他分支）、指向当前分支的指针 HEAD</ul><li><strong>远程仓库(Remote）</strong>：相对于本地仓库而言，该仓库在远程， 两者可以认为是各自的备份（但内容不一定时刻一致）<li><strong>Commit objects 节点</strong>：每次提交都会产生一个节点，相关信息存储在对象库<li><strong>heads</strong>：head 就是指向一个节点的索引。每个 head 都有自己的名字。默认情况下， 每个 Repository 都有一个叫做 master 的 head。一个Repository 可以有很多 heads（一个分支一个，位于.git/refs/heads）。 在任何时刻，只有一个 head 被当做“当前head”（当前分支）。这个 head 一般用大写字母 HEAD 表示（.git/HEAD）。HEAD 指向当前分支的最新的一次提交。<li><strong>分支</strong>：和 “head” 几乎是同义词<ul><li>一条 commit objects 节点的链条，链头（head）被命名为分支名（指向该分支的最新节点）<li>各个分支可以有相同的节点，而所有分支的所有节点信息都存储在对象库中<li>每一个分支都有一个head，每一个head都代表一个分支<li>Repository 是一棵树（也称为树对象，不同分支共用相同的节点，即一个节点可能在多条链上）， “分支” 用来表示以 head 为叶子节点的所有祖先节点的序列， 而 “head” 仅仅表示 head 所指向的那一个节点，即分支中最近被提交的节点</ul></ul><blockquote><p>git 目录结构</p></blockquote><p>这里只是粗略的标注一下各个文件夹的作用。 如果想得到更为详细地官方解读，可在终端输入 <code class="language-plaintext highlighter-rouge">git help gitrepository-layout</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre>
  .git/
  ├── COMMIT_EDITMSG  <span class="c"># 记录最近一次提交的 commit 编辑信息</span>
  ├── config          <span class="c"># 项目的配置信息，git config命令会改动它</span>
  ├── description     <span class="c"># 项目的描述信息</span>
  ├── HEAD            <span class="c"># 当前分支</span>
  ├── hooks           <span class="c"># 系统默认钩子脚本目录</span>
  │   ├── applypatch-msg.sample
  │   ├── commit-msg.sample
  │   ├── post-update.sample
  │   ├── pre-applypatch.sample
  │   ├── pre-commit.sample
  │   ├── prepare-commit-msg.sample
  │   ├── pre-push.sample
  │   ├── pre-rebase.sample
  │   └── update.sample
  ├── index           <span class="c"># 索引文件(暂存区), 二进制文件</span>
  ├── info
  │   └── exclude
  ├── logs            <span class="c"># 各个refs的历史信息, 保存所有更新的引用记录</span>
  │   ├── HEAD
  │   └── refs
  │       ├── heads
  │       │   ├── dev
  │       │   └── master
  │       └── remotes
  │           └── origin
  │               └── master
  ├── objects         <span class="c"># 可以视为 git 数据库; Git本地仓库的所有对象(commits, trees, blobs, tags)</span>
  │   ├── 2d
  │   │   └── d2c71b69c837a7459f4bd9c9f7db6520731d06
  │   ├── 5c
  │   │   └── 7b8eda18a75e13d27c31e65a54b0abd7948510
  │   ├── 77
  │   │   └── cad3aecf7c2754231095598119979d62a1e1da
  │   ├── info
  │   └── pack
  └── refs           <span class="c"># 标识你项目里的每个分支指向了哪个提交(commit)</span>
      ├── heads      <span class="c"># 目录有以各个本地分支名命名的文件，保存对应分支最新提交的ID</span>
      │   ├── dev
      │   └── master
      ├── remotes    <span class="c"># 目录有以各个远程分支名命名的文件，保存对应分支最新提交的ID</span>
      │   └── origin
      │       └── master
      └── tags       <span class="c"># 存储在开发过程中打的标签，里面的文件以标签名命令，文件内容为对应的ID</span>
</pre></table></code></div></div><blockquote><p>git 文件状态机</p></blockquote><p>文件状态涉及到的的概念：</p><ul><li><strong>未跟踪</strong>：就是新创建的文件没添加过一次，没有之前的快照记录<li><strong>已跟踪</strong>：个新创建的文件进行第一次git的添加，这样文件就有了快照记录后，这文件就转变成已跟踪状态了<li><strong>已修改状态</strong>：如果从远程仓库取出Git目录后，作了修改但还没有放到暂存区域，就是已修改状态<li><strong>暂存状态</strong>：如果对Git目录作了修改并已放入暂存区域，就属于已暂存状态<li><strong>提交状态</strong>：如果是 Git 目录中保存着的特定版本文件，也就是说将暂存区的文件提交到仓库中，就属于已提交状态 (git commit)。</ul><p><a href="/assets/img/tool/git/git-015.jpg" class="popup img-link "><img data-src="/assets/img/tool/git/git-015.jpg" alt="文件状态机" title="文件状态机" class="lazyload" data-proofer-ignore></a></p><h3 id="底层概念"><span class="mr-2">底层概念</span><a href="#底层概念" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>相对于应用层概念而言，大部分 git 用户是很少遇到底层概念。底层概念与git的内部实现紧密相关，也映射 出一套较为底层的命令。因此，要想理解git的底层原理，就很难避开这些底层概念。</p><p><strong>对象库(.git/object)</strong>有四种类型：块（blob）、目录树(tree)、提交(commit)、标签(tag)。这四种原子对象构成了 git 高层数据结构的基础。</p><ul><li><strong>blob(块对象)</strong>：在add操作后生成, blob 对象存储文件的时间内容，实际为工作空间的文件内容。具体为对文件内容使用zlib算法压缩，然后对得到的字节取hash算法。 因此相同的文件内容，得到的blob对象肯定是相同的<li><strong>tree(树对象)</strong>：在commit操作后生成, git目录树对象映射操作系统中工作空间的目录，不同的是工作空间的目录下是文件和文件夹的集合， 而目录树对象则为blob对象和目录树对象的集合。<li><strong>commit对象</strong>：一次提交即为当前版本的一个快照，该快照就是通过提交对象保存， 其存储的内容为：一个顶级树对象、上一次提交的对像啥希、提交者用户名及邮箱、提交时间戳、提交评论。</ul><p><a href="/assets/img/tool/git/git-011.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-011.png" alt="对象库变化" title="对象库变化" class="lazyload" data-proofer-ignore></a></p><p>Git对象库被组织及实现成一个内容寻址的存储系统。具体而言，对象库中的每个对象都有一个唯一的名称， 这个名称是向对象的内容应用SHA1得到的SHA1散列值。因为一个对象的完整内容决定了这个散列值， 并且认为这个散列值能有效并唯一地对应特定的内容，所以SHA1散列值用来做对象数据库中对象的名字和索引是完全充分的。 文件的任何微小变化都会导致SHA1散列值的改变，使得文件的新版本被单独编入索引</p><p>SHA散列计算的一个重要特性是不管内容在哪里，它对同样的内容始终产生同样的ID。 换言之，在不同目录里甚至不同机器中的相同文件内容产生的SHA1哈希ID是完全相同的。 因此，文件的SHA1散列ID是一种有效的全局唯一标识符</p><p>如果两个文件的内容完全一样，无论是否在相同的目录，Git在对象库里只保存一份blob形式的内容副本。 Git仅根据文件内容来计算每一个文件的散列码，如果文件有相同的SHA1值，它们的内容就是相同的， 然后将这个blob对象放到对象库里，并以SHA1值作为索引。项目中的这两个文件， 不管它们在用户的目录结构中处于什么位置，都使用那个相同的对象指代其内容。</p><p>如果这些文件中的一个发生了变化，Git会为它计算一个新的SHA1值，识别出它现在是一个不同的blob对象， 然后把这个新的blob加到对象库里。原来的blob在对象库里保持不变，为没有变化的文件所使用。</p><p>当文件从一个版本变到下一个版本的时候，Git的内部数据库有效地存储每个文件的每个版本，而不是它们的差异。 因为Git使用一个文件的全部内容的散列值作为文件名，所以它必须对每个文件的完整副本进行操作。 Git不能将工作或者对象库条目建立在文件内容的一部分或者文件的两个版本之间的差异上。</p><p>随着时间的推移，所有信息在对象库中会变化和增长，项目的编辑、添加和删除都会被跟踪和建模。 为了有效地利用磁盘空间和网络带宽，git 把对象压缩并存储在打包文件（pack file）里， 这些文件也在对象库里。</p><p>另外，还有两个比较重要但不在对象库中的概念：</p><ul><li><strong>标签(tag)</strong>：一个标签对象分配一个任意的且人类可读的名字给一个特定对象，通常是一个提交对象<li><strong>索引</strong>：索引是一个临时的、动态的二进制文件，它描述整个版本库的目录结构。 更具体地说，索引捕获项目在某个时刻的整体结构的一个版本。项目的状态可以用一个提交和一棵目录树表示， 它可以来自项目历史中的任意时刻，或者它可以是你正在开发的未来状态。</ul><p>Git的关键特色之一就是它允许你用有条理的、定义好的步骤来改变索引的内容。索引使得开发的推进与提交的变更之间能够分离开来。</p><p>作为开发人员，你通过执行Git命令在索引中暂存（stage）变更。变更通常是添加、删除或者编辑某个文件或某些文件。 索引会记录和保存那些变更，保障它们的安全直到你准备好提交了。还可以删除或替换索引中的变更。 因此，索引支持一个由你主导的从复杂的版本库状态到一个可推测的更好状态的逐步过渡。引在合并（merge），允许管理、 检查和同时操作同一个文件的多个版本中起到的重要作用</p><p><a href="/assets/img/tool/git/git-001.jpg" class="popup img-link "><img data-src="/assets/img/tool/git/git-001.jpg" alt="版本库" title="版本库" class="lazyload" data-proofer-ignore></a> <a href="/assets/img/tool/git/git-020.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-020.png" alt="版本库中各对象关系" title="版本库中各对象关系" class="lazyload" data-proofer-ignore></a> <a href="/assets/img/tool/git/git-013.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-013.png" alt="整体原理图" title="整体原理图" class="lazyload" data-proofer-ignore></a></p><blockquote><p>底层命令</p></blockquote><p>这里列出几个底层命令协助大家理解git的底层原理，具体使用方法请自行参阅其他资料。</p><ul><li><code class="language-plaintext highlighter-rouge">git hash-object -w fileName</code>：用来创建一个新的数据对象并将其手动存储到新的Git数据库中<li><code class="language-plaintext highlighter-rouge">git cat-file -p hash-object-id</code>：读取git对象内容<li><code class="language-plaintext highlighter-rouge">git cat-file -t hash-object-id</code>：读取git对象类型<li><code class="language-plaintext highlighter-rouge">git cat-file -p master^{tree}</code>：查看树对象<li><code class="language-plaintext highlighter-rouge">git ls-files -s</code>：查看暂存区内容<li>构建树对象：<ul><li>git update-index<li>git write-tree<li>git read-tree</ul><li><code class="language-plaintext highlighter-rouge">git commit-tree</code>：创建commit对象</ul><h3 id="git-存储快照是不是很低效"><span class="mr-2">git 存储快照是不是很低效</span><a href="#git-存储快照是不是很低效" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>一个聪明的读者也许已经有了关于Git的数据模型及其单独文件存储的挥之不去的问题： 直接存储每个文件每个版本的完整内容是否太低效率了？ 即使它是压缩的，把相同文件的不同版本的全部内容都存储的效率是否太低了？’ 如果你只添加一行到文件里，Git是不是要存储两个版本的全部内容？</p><p>幸运的是，答案是“不是，不完全是！”</p><p>相反，Git使用了一种叫做 打包文件（pack file） 的更有效的存储机制。 要创建一个打包文件，Git首先定位内容非常相似的全部文件，然后为它们之一存储整个内容。 之后计算相似文件之间的差异并且只存储差异。例如，如果你只是更改或者添加文件中的一行， Git可能会存储新版本的全部内容，然后记录那一行更改作为差异，并存储在包里。</p><p>存储一个文件的整个版本并存储用来构造其他版本的相似文件的差异并不是一个新伎俩。 这个机制已经被其他VCS（如RCS）用了好几十年了，它们的方法本质上是相同的。</p><p>然而，Git文件打包得非常巧妙。因为Git是由内容驱动的， 所以它并不真正关心它计算出来的两个文件之间的差异是否属于同一个文件的两个版本。 这就是说，Git可以在版本库里的任何地方取出两个文件并计算差异， 只要它认为它们足够相似来产生良好的数据压缩。因此， Git有一套相当复杂的算法来定位和匹配版本库中潜在的全局候选差异。 此外，Git可以构造一系列差异文件，从一个文件的一个版本到第二个，第三个，等等。</p><p>Git还维护打包文件表示中每个完整文件（包括完整内容的文件和通过差异重建出来的文件）的原始blob的SHA1值。 这给定位包内对象的索引机制提供了基础。</p><p>打包文件跟对象库中其他对象存储在一起。它们也用于网络中版本库的高效数据传输。</p><h2 id="图解-git-的概念关系设计"><span class="mr-2">图解 git 的概念关系设计</span><a href="#图解-git-的概念关系设计" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>git 中各个概念之间的联系或状态变迁都是通过命令（高层或底层命令）产生的，这样可以灵活组合而不乏清晰。</p><blockquote><p>一次提交过程</p></blockquote><p>一次提交过程有以下子过程：</p><ul><li>初始提交（即本次提交的上一次提交）<li>编辑文件<li>提交（相对于初始提交而言可称为二次提交）</ul><p>文件f1没有修改，在此过程后，它的blob哈希没有改变；文件f2修改内容，在此过程后文件为f22，它的blob哈希发生改变，如图： <a href="/assets/img/tool/git/git-008.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-008.png" alt="两次提交间的变化" title="两次提交间的变化" class="lazyload" data-proofer-ignore></a> <a href="/assets/img/tool/git/git-021.jpg" class="popup img-link "><img data-src="/assets/img/tool/git/git-021.jpg" alt="提交过程发生了什么" title="提交过程发生了什么" class="lazyload" data-proofer-ignore></a></p><h1 id="git-命令及其使用场景">git 命令及其使用场景</h1><p>git 命令很多，一定要善用搜索和 git 帮助文档，可以通过 <code class="language-plaintext highlighter-rouge">git help 命令动词</code> 来获得帮助，比如 <code class="language-plaintext highlighter-rouge">git help pull</code>。 如果连<em>命令动词</em>都不记得的话，可以使用<code class="language-plaintext highlighter-rouge">git help -a</code>列出所有关键字。当执行一个命令或者打错了命令，git 都会 有智能提示，根据提示操作一般都会得到解决。提示的内容一般会有以下类型：</p><ul><li>下一步操作（即继续执行）<li>相反操作（即反悔）</ul><p>需要指出的是，本章不会穷尽git命令，而是根据常用的场景来组织命令集。详尽的命令可以自行参考git的帮助文档。</p><h2 id="各区穿梭"><span class="mr-2">各区穿梭</span><a href="#各区穿梭" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>git 可以区化为：工作区、暂存区、堆栈、本地版本库、远程副本和远程仓库等。下图收集的命令可以帮助你在各大区中 任意穿梭。</p><p><a href="https://www.plantuml.com/plantuml/svg/ZLPVRnf747_dKwpy4E67a_lSXyfLqwgLelO362fTOO5Jxi_fxd0JLP5mKXDeREC4WXn3QxkDKyjAZTMq60CMtwMwtQDF_WgPPRY3jS7s2nmtlvdzpVncPrXsFTNnyeOUi-5RIscsQdg4lpdvlx3Bwy_zNfkzFIUgIpAMdfOmMSrZPuV-HPDjT0NWHyjvwDfgYage1RxxbFsr0vYueYnfPfe-MagfgHnTWeEpT751k8f7sOtj5_b-QMnpSrT2Dj-pvcbGBec7RZN-zPUVtyT0kfLIvKo6WsPmz8ALMu0L28SQbaSVpC7vlIe4dE1YiQnZvMt2zhhWp_zT0qnCL88edqqI_bJKWcYcviMYTm30jD2efjCae-dqE-ShuSrBzM5XFR8e-PZ02YTC0PrIbc70bsAGXU2aC1oSBiH6LW53VeYpyswEM8wMrKpoWwEQgTotga4ZBlF2gb9aQgR3RB7ulBe9uaR4K0YCC7gSRo6kkae9szuC_ZoLM5n3HjRRu-0RkUmJf6tP9646ZGwxgFhThIcBQjiwVOm_bd_wv0cvTs_AcdOiUsAxyH0CzVWkc31YqA-pojaJO4RmqUziYPmmfM3tPzOwPzqQM_yGVEYnIill7SAr6mwUJmNKDTSZVEymQBwOriZlRFgTtrd_cT_x8zXVGp5ci7AewraE9VyLgYF8Z3PCc2EW8J3YQW9cPG9AXisAC8X7FRAYACdRGU9UoZ2mn-EiKkVj4iw5o_u6sownypOhdKRJHBoij8RFBlp-Bc-MMV7lu7XjCUnzwLxXIOhYMXcFYFE-bvAIpDZttzmN9Fp1hy7hDoC7m2TClhVjTuv3X21pKMNbJP28bml00QiCn18cgnppdHOcuNUBw8EN9UGeoo2LpT0UqNGIgSwfB49ke7jdiZEfibSRC7D2mb9BtQ6Ve3rI3wtyYEWrRJ72SB33cyUeBt2APFK79xnsZYMQ7nbb1CsaHWqB9G6ZMGUmBy9goOvGEzRu3Kh4cp3cNcBn-Fi3Njdsks_n4pW6lxHv0UN572BIqVeIg4O7RYkcSPlKYf9JdVHydT4UYPmmB_ibrkyE3pQ6xuf1euwiGyL3MCGJhh_S4_ExWJV-0RwN_R8quaj5NclvtLVZAO_hPB9O7apMHOPwgHnHR51yDIbaLtKz6Pk2NLal1dMoTBoEbYOI2IcYMyqgBuFQNdYnvyUIQZKp9DOig1rDBteiOHZuIamxh-jaJ0NACwABJEOuO056UUFo27abJ9cPeReUTH23vynWYDpmBypY3VjyvTf2Jzw0LZBa6bwSpBUE9bd9Vk7RrJXkb-b_GFxWWA-rnkFkdPZ1wss_1nliANyDh4UTj0mVUKF_2000" class="popup img-link "><img data-src="https://www.plantuml.com/plantuml/svg/ZLPVRnf747_dKwpy4E67a_lSXyfLqwgLelO362fTOO5Jxi_fxd0JLP5mKXDeREC4WXn3QxkDKyjAZTMq60CMtwMwtQDF_WgPPRY3jS7s2nmtlvdzpVncPrXsFTNnyeOUi-5RIscsQdg4lpdvlx3Bwy_zNfkzFIUgIpAMdfOmMSrZPuV-HPDjT0NWHyjvwDfgYage1RxxbFsr0vYueYnfPfe-MagfgHnTWeEpT751k8f7sOtj5_b-QMnpSrT2Dj-pvcbGBec7RZN-zPUVtyT0kfLIvKo6WsPmz8ALMu0L28SQbaSVpC7vlIe4dE1YiQnZvMt2zhhWp_zT0qnCL88edqqI_bJKWcYcviMYTm30jD2efjCae-dqE-ShuSrBzM5XFR8e-PZ02YTC0PrIbc70bsAGXU2aC1oSBiH6LW53VeYpyswEM8wMrKpoWwEQgTotga4ZBlF2gb9aQgR3RB7ulBe9uaR4K0YCC7gSRo6kkae9szuC_ZoLM5n3HjRRu-0RkUmJf6tP9646ZGwxgFhThIcBQjiwVOm_bd_wv0cvTs_AcdOiUsAxyH0CzVWkc31YqA-pojaJO4RmqUziYPmmfM3tPzOwPzqQM_yGVEYnIill7SAr6mwUJmNKDTSZVEymQBwOriZlRFgTtrd_cT_x8zXVGp5ci7AewraE9VyLgYF8Z3PCc2EW8J3YQW9cPG9AXisAC8X7FRAYACdRGU9UoZ2mn-EiKkVj4iw5o_u6sownypOhdKRJHBoij8RFBlp-Bc-MMV7lu7XjCUnzwLxXIOhYMXcFYFE-bvAIpDZttzmN9Fp1hy7hDoC7m2TClhVjTuv3X21pKMNbJP28bml00QiCn18cgnppdHOcuNUBw8EN9UGeoo2LpT0UqNGIgSwfB49ke7jdiZEfibSRC7D2mb9BtQ6Ve3rI3wtyYEWrRJ72SB33cyUeBt2APFK79xnsZYMQ7nbb1CsaHWqB9G6ZMGUmBy9goOvGEzRu3Kh4cp3cNcBn-Fi3Njdsks_n4pW6lxHv0UN572BIqVeIg4O7RYkcSPlKYf9JdVHydT4UYPmmB_ibrkyE3pQ6xuf1euwiGyL3MCGJhh_S4_ExWJV-0RwN_R8quaj5NclvtLVZAO_hPB9O7apMHOPwgHnHR51yDIbaLtKz6Pk2NLal1dMoTBoEbYOI2IcYMyqgBuFQNdYnvyUIQZKp9DOig1rDBteiOHZuIamxh-jaJ0NACwABJEOuO056UUFo27abJ9cPeReUTH23vynWYDpmBypY3VjyvTf2Jzw0LZBa6bwSpBUE9bd9Vk7RrJXkb-b_GFxWWA-rnkFkdPZ1wss_1nliANyDh4UTj0mVUKF_2000" alt="git 命令概览" title="git 命令概览" class="lazyload" data-proofer-ignore></a></p><h2 id="改变文件状态"><span class="mr-2">改变文件状态</span><a href="#改变文件状态" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>这里的文件包括单个文件或多个文件、目录。因此下面的命令都省略了所要操作的文件名或目录名列表。</p><ul><li><code class="language-plaintext highlighter-rouge">未跟踪</code>到<code class="language-plaintext highlighter-rouge">已跟踪</code>的命令有： git add fileName<li><code class="language-plaintext highlighter-rouge">已跟踪</code>到<code class="language-plaintext highlighter-rouge">未跟踪</code>的命令有： git rm（要反悔可以按提示操作，比如 git restore）<li>暂存修改：git add fileName<li>撤销暂存（保留暂存区和工作区中相同文件的新修改）：<ul><li>少量文件推荐：git restore –staged fileName<li>git reset – fileName<li>撤销大量暂存文件推荐：git reset –<li>git rm –cached fileName</ul><li>撤销工作区的修改（但会保留暂存区中的修改）：git checkout [–] fileName</ul><p>【注意】从以上各命令的相似性和危险性来看，容易混淆容易出错，为安全起见，应遵守以下安全规则：</p><ul><li>在 git 仓库不要使用 rm，而是尽量使用 git rm<li>在操作之前尽量使用 <code class="language-plaintext highlighter-rouge">git stash save "note 一下"</code> 保留已经跟踪的文件（包括工作区和暂存区中的文件）</ul><h2 id="分支管理"><span class="mr-2">分支管理</span><a href="#分支管理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>一般一个git仓库都会根据不同的需要或者不同的开发人员都会创建多个分支，这就少不了分支间的互操作。 当处于某个特定分支时，我们经常有整理提交链条的需求。这一节我们一起来探讨一下。</p><h3 id="分支互操作"><span class="mr-2">分支互操作</span><a href="#分支互操作" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>所谓分支互操作，就是两个或两个以上分支之间的切换或复制及合并等操作。</p><p><a href="http://www.plantuml.com/plantuml/svg/ZLJDRjf04BxxANmaKdc1LgfooANlmCKObrW91XbJgJUQf618-AbAKOCRXKIkIjCaH0WHC3IyZ6VNFl4AdSqGgw4awiNipdppVT_CZjZCMuff5JAxKWv_TLNFAOObi-FhiDXXxR8_7O4xaPMy_3Qxctg4oIXvIpF1Bh5MNm3e_WYIqjv5UN6HfBIPBUHarhw1gSViDjXbLZidZ2GKvFZh9T5BEQrRicxebaG1J0aEYYTDnL2tnJr6P97KnZgukgsfEzc29SUJwsfWCdfmSlEVH89bNOrcf1ww1BiR7hkKUAQ7U8h827qxuDC6D6sqXCHKnJi7pxgAcBQ8QUQ1FIA-9vovDKImqwO_lg0qIi37NhZVmqSHSSzX3Vow4XBy_IO9urxGr99ANbj6Oy5PJJWc7OGaZ1YSUhvNftnOhl7fiWEIKhEPZ6w5d-_OoTahBA1JSFvB86nqvQ8JF2zcHma3gS3xGW7sjH-DX5MAx5k5gEw1uKatc7z2Bd27c8ygK9aVNY8sKaP9TkK6ypBl7VhZAsZqW_tV_go362WD-CM7PHUOyAVVmNR2OfSvG-xDMV47ij1ie5w2nk05GeFhdnH2SKmZ3ji1vmvh_B77BrlS6GgB0WZk0Ku6MuncZmv4aJE6vX7HqFjZgJyk8Yoexl6zoSQ_Ro6U8gEPQOsMkbgDXhooGK_jicc-Z-TqTKS4oGOj1OtfpHPgB6OsR_NGSb2_XKPxPMdekh8qYrc5jcqJl_ZNyWS0" class="popup img-link "><img data-src="http://www.plantuml.com/plantuml/svg/ZLJDRjf04BxxANmaKdc1LgfooANlmCKObrW91XbJgJUQf618-AbAKOCRXKIkIjCaH0WHC3IyZ6VNFl4AdSqGgw4awiNipdppVT_CZjZCMuff5JAxKWv_TLNFAOObi-FhiDXXxR8_7O4xaPMy_3Qxctg4oIXvIpF1Bh5MNm3e_WYIqjv5UN6HfBIPBUHarhw1gSViDjXbLZidZ2GKvFZh9T5BEQrRicxebaG1J0aEYYTDnL2tnJr6P97KnZgukgsfEzc29SUJwsfWCdfmSlEVH89bNOrcf1ww1BiR7hkKUAQ7U8h827qxuDC6D6sqXCHKnJi7pxgAcBQ8QUQ1FIA-9vovDKImqwO_lg0qIi37NhZVmqSHSSzX3Vow4XBy_IO9urxGr99ANbj6Oy5PJJWc7OGaZ1YSUhvNftnOhl7fiWEIKhEPZ6w5d-_OoTahBA1JSFvB86nqvQ8JF2zcHma3gS3xGW7sjH-DX5MAx5k5gEw1uKatc7z2Bd27c8ygK9aVNY8sKaP9TkK6ypBl7VhZAsZqW_tV_go362WD-CM7PHUOyAVVmNR2OfSvG-xDMV47ij1ie5w2nk05GeFhdnH2SKmZ3ji1vmvh_B77BrlS6GgB0WZk0Ku6MuncZmv4aJE6vX7HqFjZgJyk8Yoexl6zoSQ_Ro6U8gEPQOsMkbgDXhooGK_jicc-Z-TqTKS4oGOj1OtfpHPgB6OsR_NGSb2_XKPxPMdekh8qYrc5jcqJl_ZNyWS0" alt="git 分支互操作" title="git 分支互操作" class="lazyload" data-proofer-ignore></a></p><blockquote><p>merge 参数（分支合并）</p></blockquote><p>merge 之后发生冲突时推荐使用开源工具<a href="https://github.com/jesseduffield/lazygit">lazygit</a>来解决冲突。在merge发生冲突时在对应仓库 下终端输入 lazygit 即可，详细用法请参考相应文档。</p><ul><li><code class="language-plaintext highlighter-rouge">git merge --squash branchName -m "更清爽的提交"</code>: 把branchName中特有的所有提交合并为一次待提交状态（其中所有的commit描述信息都会被丢弃，但代码都不会少）。<li><code class="language-plaintext highlighter-rouge">git merge --no-ff branchName -m "merge branchName with --no-ff"</code>: 保留branchName中的独有的提交链条，可以清楚地看到合并的来源；一般配合rebase使用会使合并的提交 链条更笔直清爽。比如要把dev分支合并到mater分支，可以：<ul><li>git rebase master<li>git merge –no-ff dev -m “merge dev with –no-ff”</ul><li><code class="language-plaintext highlighter-rouge">git merge [--ff] branchName</code>: git在合并两个没有分叉的分支时的默认行为(特别是在 git rebase branchName 之后使用该合并策略会没有分叉，无法判断这些合并过来的commit来自哪个分支，特别是这个分支被删除后)。 保留分支提交记录，但没有像–no-ff那样的总结性的一次提交记录。</ul><p><a href="/assets/img/tool/git/git-022.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-022.png" alt="merge 参数效果对比" title="merge 参数效果对比" class="lazyload" data-proofer-ignore></a></p><blockquote><p>rebase 分支图解</p></blockquote><p>使用rebase命令的黄金法则就是：不要在公共分支中使用。否则会给其他开发的同学带来很多并且很难解决的冲突。</p><p><a href="/assets/img/tool/git/git-023.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-023.png" alt="rebase 分支" title="rebase 分支" class="lazyload" data-proofer-ignore></a></p><blockquote><p>merge 和 rebase 的区别图解</p></blockquote><p><a href="/assets/img/tool/git/git-024.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-024.png" alt="初始状态" title="初始状态" class="lazyload" data-proofer-ignore></a> <a href="/assets/img/tool/git/git-025.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-025.png" alt="merge后" title="merge后" class="lazyload" data-proofer-ignore></a> <a href="/assets/img/tool/git/git-026.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-026.png" alt="rebase后" title="rebase后" class="lazyload" data-proofer-ignore></a></p><blockquote><p>分支切换或更新交互</p></blockquote><ul><li><code class="language-plaintext highlighter-rouge">git branch –set-upstream-to=origin/远程分支名 本地分支名</code>: 将本地分支和远程分支关联<li><code class="language-plaintext highlighter-rouge">git checkout -b 本地分支名 origin/远程分支名</code>: 从远程仓库里拉取一条本地不存在的分支（如果无法识别，则需要先执行 git fetch origin/远程分支名）<li><code class="language-plaintext highlighter-rouge">git checkout -b 分支名 [commitID]</code>：基于当前分支或某个commitID创建一个新分支，并切换到新分支<li><code class="language-plaintext highlighter-rouge">git checkout 分支名</code>：切换分支<li><code class="language-plaintext highlighter-rouge">git pull 远程仓库地址 本地指定分支:远程指定分支</code>：拉取远程指定仓库指定分支到本地指定分支<li><code class="language-plaintext highlighter-rouge">git pull origin 远程分支</code>或者<code class="language-plaintext highlighter-rouge">git pull</code>：从远程分支更新本地分支<li><code class="language-plaintext highlighter-rouge">git push 远程仓库地址 本地指定分支:远程指定分支</code>：将本地指定分支推送到远程指定仓库指定分支<li><code class="language-plaintext highlighter-rouge">git push origin 远程分支</code> 或者 <code class="language-plaintext highlighter-rouge">git push</code>：从本地分支更新远程分支<li><code class="language-plaintext highlighter-rouge">git branch -d 分支</code> 或强制 <code class="language-plaintext highlighter-rouge">git branch -D 本地分支</code>：删除本地分支<li><code class="language-plaintext highlighter-rouge">git push origin :远程分支</code> 或者 <code class="language-plaintext highlighter-rouge">git push origin --delete 远程分支名</code>：删除远程分支<li><code class="language-plaintext highlighter-rouge">git branch -r -d origin/branchName</code>：删除远程分支<li><code class="language-plaintext highlighter-rouge">git fetch origin 远程分支名 &amp;&amp; git reset --hard origin/远程分支名 &amp;&amp; git pull origin 远程分支名</code>：远程强行覆盖本地代码</ul><h3 id="打补丁"><span class="mr-2">打补丁</span><a href="#打补丁" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>只是想应用某个分支的某些文件的修改，而不是全部，则可以使用打补丁的方式在提示中合并应用部分代码。</p><blockquote><p>合并部分文件</p></blockquote><p>这里假设要把分支 test1_branch 中的 test_file.txt 合并到分支 master 中的相应文件，则可以：</p><ul><li><code class="language-plaintext highlighter-rouge">git checkout master</code><li><code class="language-plaintext highlighter-rouge">git checkout --patch test1_branch test_file.txt</code><li>然后根据提示一步步操作即可</ul><blockquote><p>分支打补丁</p></blockquote><p>正常情况下，对于本地分支，我们可以直接 <code class="language-plaintext highlighter-rouge">git merge</code> 就行，然后提交就行。但是，在有些情况下需要代码审核通过之后才能提交，或者 对于某个分支你没有提交权限，此时就需要把补丁文件发送给有权限操作的人去使用这些补丁。</p><p>假设你在 fix_branch 分支中 commit 了多次，和 master 分支存在了多个不同的地方，那么，可以通过以下流程对 master 打补丁，以应用 fix_branch 中的修改。</p><ul><li><code class="language-plaintext highlighter-rouge">git checkout fix_branch</code><li><code class="language-plaintext highlighter-rouge">git format-patch -M master</code><li>然后在终端 ls 一下就可以看到 patch 文件（每次提交会生成一个补丁文件）<li>把这些补丁文件复制到其他地方或者打包发邮件给打补丁的人</ul><p>生成好了补丁之后，就可以打补丁了。</p><ul><li><code class="language-plaintext highlighter-rouge">git checkout master</code><li><code class="language-plaintext highlighter-rouge">git apply --reject</code> 所有的补丁文件（可以使用通配符）<li>如果有冲突，就根据生成的 rej 文件手动解决冲突，然后删掉相应的 rej 文件<li>解决好所有冲突之后，使用 <code class="language-plaintext highlighter-rouge">git add</code> 应用修改<li>最后使用 <code class="language-plaintext highlighter-rouge">git am --resolved</code> 告诉 git 打补丁结束</ul><h3 id="commit-整理"><span class="mr-2">commit 整理</span><a href="#commit-整理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在特定分支中，可以通过相关命令重组或修剪commit链条，包括合并多个commit为一个、删除某次提交的内容等操作。 需要注意的是：</p><ul><li>不能在公共分支中进行<li>在操作之前先创建一个分支作为备份，然后在原来的分支中进行操作<li>操作完之后要和用于备份的分支进行diff对比，确保结果符合预期</ul><blockquote><p>修改 commit 信息</p></blockquote><ul><li><code class="language-plaintext highlighter-rouge">git commit --amend -m 'new commit message'</code>: 修改最近一次提交的备注信息<li><code class="language-plaintext highlighter-rouge">git rebase -i commitID</code>: 此时会打开编辑器，在想修改的commit信息所在行的行首，把pick改成r，保存退出。 之后会跳出编辑框，然后输入新的commit信息保存，按提示继续操作即可。</ul><blockquote><p>整理 commit 节点</p></blockquote><ul><li><code class="language-plaintext highlighter-rouge">git rebase -i commitID</code>: 根据编辑框的提示和自身需求对相应的commit所在行的行首词进行修改。<ul><li>p, pick = use commit # 保留这个 commit<li>r, reword = use commit, but edit the commit message # 修改 message message<li>e, edit = use commit, but stop for amending # 停下来，修改内容<li>s, squash = use commit, but meld into previous commit # 合并<li>f, fixup = like “squash”, but discard this commit’s log message # 合并且抛弃 message<li>d, drop = remove commit # 抛弃这个 commit<li>调整commit的时间先后顺序：只要调换行顺序即可，不建议这样做，因为会导致时间错乱。</ul><li><code class="language-plaintext highlighter-rouge">git reset --soft commitID</code>: 把其中的commit信息都去掉，但文件内容会保留在暂存区。此时你可以：<ul><li>git commit -m “提交信息”: 作为一个提交，并且赋予新的提交信息<li>git restore –stage fileOrFold: 把部分文件放回工作区，分几次提交</ul><li><code class="language-plaintext highlighter-rouge">git reset --hard commitID</code>: 直接重置到该commitID，丢弃最近到commitID的所有提交<li><code class="language-plaintext highlighter-rouge">git revert commitID</code>：撤销某次指定提交，原来的提交记录还在，只是当前代码已经不包含已被车撤销的提交。一般用于公共分支</ul><blockquote><p>里程碑或打 tag，更友好的描述信息</p></blockquote><p>对于已经完成一个大的版本或者里程碑，需要定格时，在不想或不便于新建分支的情况下，可以打 tag。</p><ul><li><code class="language-plaintext highlighter-rouge">git tag</code> -a tagName -m “描述一下”：建立本地标签<li><code class="language-plaintext highlighter-rouge">git push origin tagName</code>：提送到远程仓库（也可以通过 <code class="language-plaintext highlighter-rouge">git push origin --tags</code> 把所有的标签都推送）</ul><p>其他常用的 tag 操作：</p><ul><li><code class="language-plaintext highlighter-rouge">git tag</code>：列出本地当前分支的所有 tag<li><code class="language-plaintext highlighter-rouge">git tag -l v1.0.\*</code>：通过通配符显示特定的 tag<li><code class="language-plaintext highlighter-rouge">git show tagName</code>：显示标签的详细信息<li><code class="language-plaintext highlighter-rouge">git tag -d tagName</code>：本地删除标签 tagName<li><code class="language-plaintext highlighter-rouge">git push origin :refs/tags/tagName</code>：删除远程 tag（应在删除本地 tag 之后）<li><code class="language-plaintext highlighter-rouge">git push origin --delete tag tagName</code>：删除远程 tag</ul><h3 id="查看分支列表"><span class="mr-2">查看分支列表</span><a href="#查看分支列表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><code class="language-plaintext highlighter-rouge">git branch</code>: 查看本地分支列表<li><code class="language-plaintext highlighter-rouge">git branch --merged</code>：已经合并到当前分支的分支<li><code class="language-plaintext highlighter-rouge">git branch --no-merged</code>：还没有合并到当前分支的分支<li><code class="language-plaintext highlighter-rouge">git branch -a</code>: 查看所有分支列表，包括远程和本地</ul><h2 id="差异比较"><span class="mr-2">差异比较</span><a href="#差异比较" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>在提交前或合并前最好先知道你到底改了些什么，是否符合预期，这样可以达到二次检查的目的。</p><p><a href="https://www.plantuml.com/plantuml/svg/ZLFDQjj04BxlKmovoutKdeefRabBUshkgG-oPCiY-X6IJ0Ab4DhQE3WXXeIq145IQ22KDEsXu1yQyZBQLV8MNMbNZGPZoCMxdc--dzbTDQ9O3-EUwv1eq_O2FTHTMESLsx03tOlNTTEqFGkqrGh-mjykw-eg8S5zEz39UNgTqBqvw15i-U5c5EX66xMmau_qvrVPmjqj3DEp0JiRIYpg4jBojs659PSq-Ptj3lFD_705KwuFwUu-7GxOqQ-Ss58HB02jG3JIzapWabBtzYR9BaPBT0Kew6fE3zLx-l_XG7acndWAbXq3FnYI_otgBLKK3Tzr-QAuf1WAwXmh1IHF057NtnBRnllixp4zc7o03ILe4cA5VYy0EjvBfplfz8T8HGVzkqyNbInr7CQqEnsPfbx6aMLG54CtkcqJDZgsqtuRll8TimdlF633uzkTVhMnK32n3HPx_VBv6W-gD97Q4WQNYtiHQQcewlWMA84ygZThYx5EpxDan4x7xF8REnYdy-_fpHKxccKddsb_al8tCEZJgrb-G-LffTDzVc2yGVRFHdTV_WXVd5-wgdBL-Cnua9AZBN0Uo_N90gSIHDmMzaTQec6fRrZDweUsPNkFggzpaQSX7l9u21zb57UJFqFqgTLgDIc9kSNW3VxJSvr_" class="popup img-link "><img data-src="https://www.plantuml.com/plantuml/svg/ZLFDQjj04BxlKmovoutKdeefRabBUshkgG-oPCiY-X6IJ0Ab4DhQE3WXXeIq145IQ22KDEsXu1yQyZBQLV8MNMbNZGPZoCMxdc--dzbTDQ9O3-EUwv1eq_O2FTHTMESLsx03tOlNTTEqFGkqrGh-mjykw-eg8S5zEz39UNgTqBqvw15i-U5c5EX66xMmau_qvrVPmjqj3DEp0JiRIYpg4jBojs659PSq-Ptj3lFD_705KwuFwUu-7GxOqQ-Ss58HB02jG3JIzapWabBtzYR9BaPBT0Kew6fE3zLx-l_XG7acndWAbXq3FnYI_otgBLKK3Tzr-QAuf1WAwXmh1IHF057NtnBRnllixp4zc7o03ILe4cA5VYy0EjvBfplfz8T8HGVzkqyNbInr7CQqEnsPfbx6aMLG54CtkcqJDZgsqtuRll8TimdlF633uzkTVhMnK32n3HPx_VBv6W-gD97Q4WQNYtiHQQcewlWMA84ygZThYx5EpxDan4x7xF8REnYdy-_fpHKxccKddsb_al8tCEZJgrb-G-LffTDzVc2yGVRFHdTV_WXVd5-wgdBL-Cnua9AZBN0Uo_N90gSIHDmMzaTQec6fRrZDweUsPNkFggzpaQSX7l9u21zb57UJFqFqgTLgDIc9kSNW3VxJSvr_" alt="差异比较" title="差异比对" class="lazyload" data-proofer-ignore></a></p><h3 id="commit-前比较"><span class="mr-2">commit 前比较</span><a href="#commit-前比较" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>提交前确认一下这次到底改了些什么之后再提交会安心很多！</p><ul><li><code class="language-plaintext highlighter-rouge">git status</code>：显示修改过的文件列表<li><code class="language-plaintext highlighter-rouge">git diff</code>：未 add 时的文件变化情况（命令后可接具体的文件等）<li><code class="language-plaintext highlighter-rouge">git diff --cached/--stage</code>：在 add 之后 commit 之前文件变化情况（命令后可接具体的文件等）<li><code class="language-plaintext highlighter-rouge">git diff HEAD</code>：在 commit 前文件变化情况（前两条命令和合并）</ul><p>以上命令都可以指定版本、分支或具体文件，以聚焦自己感兴趣的内容</p><h3 id="commit-后比较"><span class="mr-2">commit 后比较</span><a href="#commit-后比较" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>要想知道最近一次或某次历史提交修改的具体内容，可以使用 git log 或 git diff 等命令。</p><ul><li><code class="language-plaintext highlighter-rouge">git log</code>：提交的历史记录<li><code class="language-plaintext highlighter-rouge">git log --oneline</code>：简化 log 显示<li><code class="language-plaintext highlighter-rouge">git log --stat</code>：输出 log 的统计信息<li><code class="language-plaintext highlighter-rouge">git log -p</code>：输出修改的具体内容<li><code class="language-plaintext highlighter-rouge">git log --author=作者</code>：指定显示某个作者的提交记录<li><code class="language-plaintext highlighter-rouge">git diff 版本1 版本2</code>：列出相同分支两个版本之间的差异，这个在 rebase 多个提交时可以提供参考<li><code class="language-plaintext highlighter-rouge">git blame 文件</code>：追踪是谁改了哪些代码</ul><p>以上命令都可以指定版本或具体文件，以聚焦自己感兴趣的内容</p><h3 id="不同分支间比较"><span class="mr-2">不同分支间比较</span><a href="#不同分支间比较" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>我们在基于某个分支新建了一个分支作为开发或bug修复，在合并或提交前往往想知道 改了些什么，是否符合预期。</p><ul><li><code class="language-plaintext highlighter-rouge">git log --left-right dev...master</code>：查看两个分支提交记录的不同处，主要用于合并分支前<li><code class="language-plaintext highlighter-rouge">git diff 分支1 分支2</code>：列出两个分支最近不同的详细信息<li><code class="language-plaintext highlighter-rouge">git diff 分支1...分支2</code>：列出两个分支所有不同的详细信息<li><code class="language-plaintext highlighter-rouge">git diff 分支1 分支2 --stat</code>：列出两个分支的不同点的统计信息</ul><h3 id="不同仓库间比较"><span class="mr-2">不同仓库间比较</span><a href="#不同仓库间比较" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>只要两个仓库都是git仓库，两个不同的仓库也是可以比对差异的，常用的是<code class="language-plaintext highlighter-rouge">git diff</code> 命令，详细参考前面的章节。 这种场景主要用于某个仓库是由另一个仓库衍生发展而来的情况。</p><h3 id="工具"><span class="mr-2">工具</span><a href="#工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>如果你只想使用 git 自带的工具，可以 <code class="language-plaintext highlighter-rouge">git diff --word-diff</code> 或者 <code class="language-plaintext highlighter-rouge">git diff --color-words</code>。 至于 diff 工具本人推荐使用开源工具 <a href="https://github.com/dandavison/delta">dandavison/delta</a>，其中 .gitconfig 配置如下。事实上，该工具对 git log 也有更友好的显示方式。</p><div class="language-toml highlighter-rouge"><div class="code-header"> <span data-label-text="TOML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="nn">[core]</span>
  <span class="py">pager</span> <span class="p">=</span> <span class="err">delta</span>

<span class="nn">[interactive]</span>
    <span class="py">diffFilter</span> <span class="p">=</span> <span class="err">delta</span> <span class="err">--color-only</span>

<span class="nn">[delta]</span>
    <span class="py">navigate</span> <span class="p">=</span> <span class="kc">true</span>  <span class="c"># use n and N to move between diff sections</span>
    <span class="py">side-by-side</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="py">commit-decoration-style</span> <span class="p">=</span> <span class="err">none</span>
    <span class="py">dark</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="py">file-added-label</span> <span class="p">=</span> <span class="p">[</span><span class="err">+</span><span class="p">]</span>
    <span class="py">file-copied-label</span> <span class="p">=</span> <span class="p">[</span><span class="err">C</span><span class="p">]</span>
    <span class="py">file-decoration-style</span> <span class="p">=</span> <span class="err">none</span>
    <span class="py">file-modified-label</span> <span class="p">=</span> <span class="p">[</span><span class="err">M</span><span class="p">]</span>
    <span class="py">file-removed-label</span> <span class="p">=</span> <span class="p">[</span><span class="err">-</span><span class="p">]</span>
    <span class="py">file-renamed-label</span> <span class="p">=</span> <span class="p">[</span><span class="err">R</span><span class="p">]</span>
    <span class="py">file-style</span> <span class="p">=</span> <span class="mi">232</span> <span class="err">bold</span> <span class="mi">184</span>
    <span class="py">hunk-header-decoration-style</span> <span class="p">=</span> <span class="err">none</span>
    <span class="py">hunk-header-file-style</span> <span class="p">=</span> <span class="s">"#999999"</span>
    <span class="py">hunk-header-line-number-style</span> <span class="p">=</span> <span class="err">bold</span> <span class="s">"#03a4ff"</span>
    <span class="py">hunk-header-style</span> <span class="p">=</span> <span class="err">file</span> <span class="err">line-number</span> <span class="err">syntax</span>
    <span class="py">line-numbers</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="py">line-numbers-left-style</span> <span class="p">=</span> <span class="err">black</span>
    <span class="py">line-numbers-minus-style</span> <span class="p">=</span> <span class="s">"#B10036"</span>
    <span class="py">line-numbers-plus-style</span> <span class="p">=</span> <span class="s">"#03a4ff"</span>
    <span class="py">line-numbers-right-style</span> <span class="p">=</span> <span class="err">black</span>
    <span class="py">line-numbers-zero-style</span> <span class="p">=</span> <span class="s">"#999999"</span>
    <span class="py">minus-emph-style</span> <span class="p">=</span> <span class="err">syntax</span> <span class="err">bold</span> <span class="s">"#780000"</span>
    <span class="py">minus-style</span> <span class="p">=</span> <span class="err">syntax</span> <span class="s">"#400000"</span>
    <span class="py">plus-emph-style</span> <span class="p">=</span> <span class="err">syntax</span> <span class="err">bold</span> <span class="s">"#007800"</span>
    <span class="py">plus-style</span> <span class="p">=</span> <span class="err">syntax</span> <span class="s">"#004000"</span>
    <span class="py">whitespace-error-style</span> <span class="p">=</span> <span class="s">"#280050"</span> <span class="err">reverse</span>
    <span class="py">zero-style</span> <span class="p">=</span> <span class="err">syntax</span>
    <span class="py">syntax-theme</span> <span class="p">=</span> <span class="err">Nord</span>

<span class="nn">[merge]</span>
    <span class="py">conflictstyle</span> <span class="p">=</span> <span class="err">diff</span><span class="mi">3</span>

<span class="nn">[diff]</span>
    <span class="py">colorMoved</span> <span class="p">=</span> <span class="err">default</span>

</pre></table></code></div></div><p><a href="/assets/img/tool/git/git-027.png" class="popup img-link "><img data-src="/assets/img/tool/git/git-027.png" alt="diff 效果图" title="diff 效果图" class="lazyload" data-proofer-ignore></a></p><h2 id="查看或搜索提交历史"><span class="mr-2">查看或搜索提交历史</span><a href="#查看或搜索提交历史" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>好的 commit 描述和拆分合并策略有助于 git log 的展示，同时帮助了解代码的时间线。 一般遵循以下原则：</p><ul><li>外部库引入或者依赖包更新等单独作为一次提交<li>自身业务代码，按相对完整的功能进行提交，便于功能增删或回滚<li>bug 修复和性能优化等不同目的和性质的更新要分开提交</ul><blockquote><p>log 的各种参数</p></blockquote><p>log 查看工具推荐开源工具<a href="https://github.com/rbong/vim-flog">vim-flog</a>，常用命令<code class="language-plaintext highlighter-rouge">Flog -all</code>。</p><ul><li>详细的提交信息：<code class="language-plaintext highlighter-rouge">git log [-n] [branchName] [fileOrFold1] [fileOrFold2]</code> 其中 n 指的是你感兴趣的 log 条数<li>查看提交的统计信息：<code class="language-plaintext highlighter-rouge">git log --stat</code> ，这包括了更新的文件列表<li>单行显示：<code class="language-plaintext highlighter-rouge">git log --oneline</code> ，这会缩写 commitID<li>ASCII 图形显示：<code class="language-plaintext highlighter-rouge">git log --graph</code> ，本人更喜欢用 vim 插件，相对而言更友好。<li>只显示某个人的提交：git log –anthor=oneName<li>使用 <code class="language-plaintext highlighter-rouge">grep</code>：git log –grep=”要匹配的串”<li>查看包含特定字符串的提交：<code class="language-plaintext highlighter-rouge">git log [-i] [-p] -S"function login()"</code><li>根据是否merge来过滤提交历史：<code class="language-plaintext highlighter-rouge">git log --merges</code> 或者 <code class="language-plaintext highlighter-rouge">git log --no-merges</code><li>显示某段时间内的提交：<code class="language-plaintext highlighter-rouge">git log --since=2.weeks</code></ul><h2 id="后悔药"><span class="mr-2">后悔药</span><a href="#后悔药" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>只要是已经被git跟踪的文件，一般都会有后悔药（即撤销、回滚操作）。</p><ul><li>add 之前丢弃修改：<code class="language-plaintext highlighter-rouge">git checkout -- fileOrFold</code> ，如果想再次找回这些修改，则无能为力了。 因此，最好操作前做好备份。<li>add 之后，commit 之前：<code class="language-plaintext highlighter-rouge">git reset HEAD fileOrFold</code> 或者 <code class="language-plaintext highlighter-rouge">git restore --staged fileOrFold</code><li>commit 之后，push 之前：<ul><li><code class="language-plaintext highlighter-rouge">git reset --soft HEAD^</code> 或者<li><code class="language-plaintext highlighter-rouge">git reset HEAD^</code> 或者<li><code class="language-plaintext highlighter-rouge">git reset --hard HEAD^</code> 或者<li><code class="language-plaintext highlighter-rouge">git revert HEAD </code><li>它们的区别或者其他方法请参考“整理 commit 节点”一节</ul><li>rebase 过程中撤销本次 rebase：<code class="language-plaintext highlighter-rouge">git rebase --abort</code><li>merge 过程中撤销： <code class="language-plaintext highlighter-rouge">git merge --abort</code><li>rebase 或者 merge 成功之后撤销：<ul><li><code class="language-plaintext highlighter-rouge">git reflog</code> 找到操作前的 commitID<li><code class="language-plaintext highlighter-rouge">git reset --hard commitID</code></ul><li>修改了代码，git add 之后发现分支搞错了，必须切换分支，可以：<ul><li><code class="language-plaintext highlighter-rouge">git stash save "note 一下"</code> ，暂时把修改保留到堆栈区<li><code class="language-plaintext highlighter-rouge">git checkout branchName</code>，切换到目的分支<li><code class="language-plaintext highlighter-rouge">git stash apply stash@{0}</code>，如果不知道是哪一个，可以用 <code class="language-plaintext highlighter-rouge">git stash list</code> 查看列表</ul><li>代码提交了，才发现搞错了分支（原分支 branch1，目的分支 branch2），可以：<ul><li><code class="language-plaintext highlighter-rouge">git checkout branch2</code><li><code class="language-plaintext highlighter-rouge">git log branch1</code> 查出 commtiID<li><code class="language-plaintext highlighter-rouge">git cherry-pick commitID</code> 此时提交已经落到该去的分支了<li><code class="language-plaintext highlighter-rouge">git checkout branch1</code><li><code class="language-plaintext highlighter-rouge">git reset --hard HEAD^</code> 此时在错误的分支中删掉了不需要的最近提交</ul><li>不小心把还未push的分支删除了：<ul><li><code class="language-plaintext highlighter-rouge">git log -g</code> 或者 <code class="language-plaintext highlighter-rouge">git reflog</code> 找出被误删分支的最近一次提交的 commitID<li><code class="language-plaintext highlighter-rouge">git checkout -b 误删分支名 commitID</code></ul></ul><h2 id="git-操作原则"><span class="mr-2">git 操作原则</span><a href="#git-操作原则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>有了这篇文章的帮助，我想你已经对git有了非常全面和深刻的理解，内心开始飘了，有了 随心所欲地冲动。经验告诉我，此时是你冒险犯大错的开始！<em>最疯狂之时，也就是毁灭之时</em>。 为此，我为你准备了以下心法，帮助你克服自大的心理，尽量养成低风险的操作习惯：</p><ul><li>在做任何操作之前请做好备份<ul><li>commit 尽量直观，言简意赅<li>常用 git stash<li>常建备份分支<li>常打tag</ul><li>任意操作之后要做 diff，明确改动<li>尽量少在公共分支操作，尽量保留合并记录<li>不要过分依赖“后悔药”<li>不要手动或用脚本操作 .git 隐藏目录</ul><p><em>你不知道的东西远远多于你知道的，谦虚不是客套话，而是客观需要</em></p><h1 style="visibility: hidden;" id="want-cmm"> 我要评论</h1></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=git%20%E9%AB%98%E6%89%8B%E8%B7%83%E8%BF%81%20-%20Code-Winder&url=%2F%2Fcode-winder.github.io%2F2022%2F04%2Fgit-jump.html" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=git%20%E9%AB%98%E6%89%8B%E8%B7%83%E8%BF%81%20-%20Code-Winder&u=%2F%2Fcode-winder.github.io%2F2022%2F04%2Fgit-jump.html" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2F%2Fcode-winder.github.io%2F2022%2F04%2Fgit-jump.html&text=git%20%E9%AB%98%E6%89%8B%E8%B7%83%E8%BF%81%20-%20Code-Winder" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">Cpp</a> <a class="post-tag" href="/tags/it-basic/">IT_Basic</a> <a class="post-tag" href="/tags/tool/">Tool</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/go/">Go</a> <a class="post-tag" href="/tags/it-basic/">IT-Basic</a> <a class="post-tag" href="/tags/think/">Think</a> <a class="post-tag" href="/tags/vim/">Vim</a></div></div></div><script> (function() { $("#content-list").click(function(event){ var e=window.event || event; if(e.stopPropagation){ e.stopPropagation(); }else{ e.cancelBubble = true; } if($('#markdown-toc').is(':hidden')){ $('#markdown-toc').show(); }else{ $('#markdown-toc').hide(); } }); $("#markdown-toc").click(function(event){ var e=window.event || event; if(e.stopPropagation){ e.stopPropagation(); }else{ e.cancelBubble = true; } }); $(document).click(function(event) { $("#markdown-toc").hide(); }); }()); </script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"><ul class="nav navbar-nav"><li><a href="#俯视-git" class="nav-link">俯视 git</a><ul class="nav navbar-nav"><li><a href="#基本流程" class="nav-link">基本流程</a><li><a href="#基本概念" class="nav-link">基本概念</a><ul class="nav navbar-nav"><li><a href="#应用层面的概念" class="nav-link">应用层面的概念</a><li><a href="#底层概念" class="nav-link">底层概念</a><li><a href="#git-存储快照是不是很低效" class="nav-link">git 存储快照是不是很低效</a></ul><li><a href="#图解-git-的概念关系设计" class="nav-link">图解 git 的概念关系设计</a></ul><li><a href="#git-命令及其使用场景" class="nav-link">git 命令及其使用场景</a><ul class="nav navbar-nav"><li><a href="#各区穿梭" class="nav-link">各区穿梭</a><li><a href="#改变文件状态" class="nav-link">改变文件状态</a><li><a href="#分支管理" class="nav-link">分支管理</a><ul class="nav navbar-nav"><li><a href="#分支互操作" class="nav-link">分支互操作</a><li><a href="#打补丁" class="nav-link">打补丁</a><li><a href="#commit-整理" class="nav-link">commit 整理</a><li><a href="#查看分支列表" class="nav-link">查看分支列表</a></ul><li><a href="#差异比较" class="nav-link">差异比较</a><ul class="nav navbar-nav"><li><a href="#commit-前比较" class="nav-link">commit 前比较</a><li><a href="#commit-后比较" class="nav-link">commit 后比较</a><li><a href="#不同分支间比较" class="nav-link">不同分支间比较</a><li><a href="#不同仓库间比较" class="nav-link">不同仓库间比较</a><li><a href="#工具" class="nav-link">工具</a></ul><li><a href="#查看或搜索提交历史" class="nav-link">查看或搜索提交历史</a><li><a href="#后悔药" class="nav-link">后悔药</a><li><a href="#git-操作原则" class="nav-link">git 操作原则</a></ul><li><a href="#want-cmm" class="nav-link"> 我要评论 </a></ul></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/2021/05/git.html"><div class="card-body"> <em class="small" data-ts="1622275852" data-df="YYYY/MM/DD" > 2021/05/29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>git 常用技巧</h3><div class="text-muted small"><p> 本文旨在介绍 git 的常用操作技巧，尽量覆盖常用使用场景，以充分利用 git 这个高效的代码管理 工具。 获取帮助 初始化 git 项目 设置常用配置 项目初始化 修改了些什么？ 提交前改了啥 提交之后的某个版本改了啥 分支合并前改了啥 丢弃修改 ...</p></div></div></a></div><div class="card"> <a href="/2022/05/text-draw-uml.html"><div class="card-body"> <em class="small" data-ts="1652799499" data-df="YYYY/MM/DD" > 2022/05/17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>画图，简单到无法拒绝</h3><div class="text-muted small"><p> 本文介绍一种通过文本代码来画常用图的方法，包括脑图、UML图、原型界面等。 只需要一个链接就可以展示图、修改图、随时随地传送图等，可以消除常常忘记可编辑 原图的文件在哪里、不便修改、图中内容不可复制、不可重定向等各种烦恼。 工具简介 想法落地流 图模板 使用方法 模板 脑图(思维导图) ...</p></div></div></a></div><div class="card"> <a href="/2022/06/docker.html"><div class="card-body"> <em class="small" data-ts="1655622499" data-df="YYYY/MM/DD" > 2022/06/19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>docker 精要</h3><div class="text-muted small"><p> docker 在开发、测试、部署和微服务治理、PaaS（平台即服务）以及云原生或云计算等领域已举足轻重。本文将简要探讨 一下 docker，主要从使用角度（而非源代码角度）的各个层面呈现其功能的强大和设计上的魅力。 远观 docker docker 容器集群编排工具 DockerFile docker compose Docke...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2021/12/leetcode.html" class="btn btn-outline-primary" prompt="上一篇"><p>leetCode 题解</p></a> <a href="/2022/05/text-draw-uml.html" class="btn btn-outline-primary" prompt="下一篇"><p>画图，简单到无法拒绝</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">Cpp</a> <a class="post-tag" href="/tags/it-basic/">IT_Basic</a> <a class="post-tag" href="/tags/tool/">Tool</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/go/">Go</a> <a class="post-tag" href="/tags/it-basic/">IT-Basic</a> <a class="post-tag" href="/tags/think/">Think</a> <a class="post-tag" href="/tags/vim/">Vim</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/code-winder">code-winder</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div style="text-align:center;width: 90%;"><p class="mb-0"> 总访问量 <span id="busuanzi_value_site_pv" style="color: blue;"></span> ，访客数 <span id="busuanzi_value_site_uv" style="color: blue;"></span> ，本文总阅读量 <span id="busuanzi_value_page_pv" style="color: blue;"> </span></p></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="footer-right"><p class="mb-0">本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">发现新版本的内容。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/zh.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-72449510-4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-72449510-4'); }); </script>
